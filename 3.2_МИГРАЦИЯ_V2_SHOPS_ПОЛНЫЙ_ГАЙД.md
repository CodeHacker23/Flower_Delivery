# üè™ –ú–ò–ì–†–ê–¶–ò–Ø V2: –¢–ê–ë–õ–ò–¶–ê SHOPS - –ü–û–õ–ù–´–ô –ì–ê–ô–î

**–î–∞—Ç–∞:** 2026-01-26  
**–§–∞–π–ª:** `src/main/resources/db/migration/V2__create_shops_table.sql`

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–ß—Ç–æ –º—ã —Å–æ–∑–¥–∞–ª–∏](#—á—Ç–æ-–º—ã-—Å–æ–∑–¥–∞–ª–∏)
2. [FOREIGN KEY (–í–Ω–µ—à–Ω–∏–π –∫–ª—é—á) - –î–ï–¢–ê–õ–¨–ù–û](#foreign-key)
3. [ON DELETE CASCADE - —á—Ç–æ —ç—Ç–æ –∏ –∑–∞—á–µ–º](#on-delete-cascade)
4. [DECIMAL - —Ç–æ—á–Ω—ã–µ —á–∏—Å–ª–∞](#decimal)
5. [CHECK constraint - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö](#check-constraint)
6. [UNIQUE constraint - —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å](#unique-constraint)
7. [–°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã](#—Å–æ—Å—Ç–∞–≤–Ω—ã–µ-–∏–Ω–¥–µ–∫—Å—ã)
8. [–°–≤—è–∑—å 1:1 vs 1:Many](#—Å–≤—è–∑—å-1-1-vs-1-many)
9. [–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã](#–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ-–ø—Ä–∏–º–µ—Ä—ã)

---

# –ß–¢–û –ú–´ –°–æ–∑–¥–∞–ª–∏

**–¢–∞–±–ª–∏—Ü–∞ `shops`** - —Ö—Ä–∞–Ω–∏—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∞–≥–∞–∑–∏–Ω–∞—Ö:
- –ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞
- –ê–¥—Ä–µ—Å –∑–∞–±–æ—Ä–∞ —Ç–æ–≤–∞—Ä–æ–≤
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (—à–∏—Ä–æ—Ç–∞, –¥–æ–ª–≥–æ—Ç–∞)
- –¢–µ–ª–µ—Ñ–æ–Ω –º–∞–≥–∞–∑–∏–Ω–∞
- –§–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–°–≤—è–∑—å —Å `users`:**
- `shops.user_id` ‚Üí `users.id` (FOREIGN KEY)
- –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –æ–¥–∏–Ω –º–∞–≥–∞–∑–∏–Ω (1:1)

---

# FOREIGN KEY (–í–Ω–µ—à–Ω–∏–π –∫–ª—é—á)

## üéØ –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ:

**FOREIGN KEY (FK)** - —ç—Ç–æ —Å–≤—è–∑—å –º–µ–∂–¥—É –¥–≤—É–º—è —Ç–∞–±–ª–∏—Ü–∞–º–∏ –≤ –ë–î.

**–ê–Ω–∞–ª–æ–≥–∏—è:**
- –ü—Ä–µ–¥—Å—Ç–∞–≤—å, —á—Ç–æ —É —Ç–µ–±—è –µ—Å—Ç—å —Ç–∞–±–ª–∏—Ü–∞ `–ø–∞—Å–ø–æ—Ä—Ç–∞` –∏ —Ç–∞–±–ª–∏—Ü–∞ `–≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ_–ø—Ä–∞–≤–∞`
- –í `–≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ_–ø—Ä–∞–≤–∞` –µ—Å—Ç—å –ø–æ–ª–µ `–Ω–æ–º–µ—Ä_–ø–∞—Å–ø–æ—Ä—Ç–∞`
- FOREIGN KEY –≥–æ–≤–æ—Ä–∏—Ç: "`–Ω–æ–º–µ—Ä_–ø–∞—Å–ø–æ—Ä—Ç–∞` –î–û–õ–ñ–ï–ù —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ç–∞–±–ª–∏—Ü–µ `–ø–∞—Å–ø–æ—Ä—Ç–∞`"
- –ù–µ–ª—å–∑—è –≤—ã–¥–∞—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–∞—Å–ø–æ—Ä—Ç!

## üìù –°–∏–Ω—Ç–∞–∫—Å–∏—Å:

```sql
user_id UUID NOT NULL REFERENCES users(id)
```

**–†–∞–∑–±–æ—Ä –ø–æ —Å–ª–æ–≤–∞–º:**

1. **`user_id`** - –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ `shops`
2. **`UUID`** - —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö (–¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `users.id`)
3. **`NOT NULL`** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ (–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º)
4. **`REFERENCES users(id)`** - —ç—Ç–æ –∏ –µ—Å—Ç—å FOREIGN KEY!
   - –ì–æ–≤–æ—Ä–∏—Ç: "`user_id` –¥–æ–ª–∂–µ–Ω —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ `id` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`"

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:

```sql
-- 1. –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
INSERT INTO users (telegram_id, full_name) 
VALUES (123456789, '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤');
-- –ü–æ–ª—É—á–∏–ª–∏ id = 'abc-123-def'

-- 2. –°–æ–∑–¥–∞–µ–º –º–∞–≥–∞–∑–∏–Ω –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
INSERT INTO shops (user_id, shop_name, pickup_address) 
VALUES ('abc-123-def', '–¶–≤–µ—Ç—ã –Ω–∞ –õ–µ–Ω–∏–Ω–∞', '—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10');
-- ‚úÖ –†–ê–ë–û–¢–ê–ï–¢! user_id —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ users
```

### ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:

```sql
-- –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
INSERT INTO shops (user_id, shop_name, pickup_address) 
VALUES ('xyz-999-–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π', '–¶–≤–µ—Ç—ã', '—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10');
-- ‚ùå –û–®–ò–ë–ö–ê! FOREIGN KEY constraint violation
-- PostgreSQL: "user_id 'xyz-999-–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ users"
```

## üéØ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:

1. **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:**
   - –ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –î–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã (–Ω–µ—Ç "–≤–∏—Å—è—á–∏—Ö" —Å—Å—ã–ª–æ–∫)

2. **–ó–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫:**
   - –ï—Å–ª–∏ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí —á—Ç–æ –¥–µ–ª–∞—Ç—å —Å –º–∞–≥–∞–∑–∏–Ω–æ–º?
   - FOREIGN KEY + ON DELETE CASCADE —Ä–µ—à–∞–µ—Ç —ç—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

3. **–Ø–≤–Ω–∞—è —Å–≤—è–∑—å:**
   - –í–∏–¥–Ω–æ, —á—Ç–æ `shops` —Å–≤—è–∑–∞–Ω–∞ —Å `users`
   - –õ–µ–≥—á–µ –ø–æ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î

---

# ON DELETE CASCADE

## üéØ –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ:

**ON DELETE CASCADE** - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ, —á—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∞–Ω–Ω–æ–π –∑–∞–ø–∏—Å–∏.

**–ê–Ω–∞–ª–æ–≥–∏—è:**
- –ï—Å–ª–∏ —É–¥–∞–ª–∏—Ç—å –ø–∞—Å–ø–æ—Ä—Ç ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–∞–≤–∞ –Ω–∞ —ç—Ç–æ—Ç –ø–∞—Å–ø–æ—Ä—Ç
- –ù–µ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è "–≤–∏—Å—è—á–∏—Ö" –ø—Ä–∞–≤ –±–µ–∑ –ø–∞—Å–ø–æ—Ä—Ç–∞

## üìù –°–∏–Ω—Ç–∞–∫—Å–∏—Å:

```sql
user_id UUID REFERENCES users(id) ON DELETE CASCADE
```

**–†–∞–∑–±–æ—Ä:**
- **`ON DELETE`** - "–ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏"
- **`CASCADE`** - "–∫–∞—Å–∫–∞–¥–Ω–æ —É–¥–∞–ª–∏—Ç—å" (—É–¥–∞–ª–∏—Ç—å –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏)

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### –ü—Ä–∏–º–µ—Ä 1: –ë–ï–ó CASCADE (–ø–ª–æ—Ö–æ):

```sql
-- –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –º–∞–≥–∞–∑–∏–Ω
INSERT INTO users (telegram_id, full_name) VALUES (123, '–ò–≤–∞–Ω');
-- id = 'user-123'

INSERT INTO shops (user_id, shop_name, pickup_address) 
VALUES ('user-123', '–¶–≤–µ—Ç—ã', '—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10');

-- –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
DELETE FROM users WHERE id = 'user-123';

-- –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
-- ‚ùå –ú–∞–≥–∞–∑–∏–Ω –û–°–¢–ê–õ–°–Ø –≤ –ë–î, –Ω–æ user_id = 'user-123' –±–æ–ª—å—à–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!
-- –≠—Ç–æ "–≤–∏—Å—è—á–∞—è" —Å—Å—ã–ª–∫–∞ (orphaned record) - –ü–õ–û–•–û!
-- –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –Ω–∞–π—Ç–∏ –º–∞–≥–∞–∑–∏–Ω –ø–æ user_id ‚Üí –æ—à–∏–±–∫–∞ –∏–ª–∏ –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
```

### –ü—Ä–∏–º–µ—Ä 2: –° CASCADE (—Ö–æ—Ä–æ—à–æ):

```sql
-- –¢–∞–±–ª–∏—Ü–∞ shops —Å ON DELETE CASCADE
CREATE TABLE shops (
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    ...
);

-- –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –º–∞–≥–∞–∑–∏–Ω
INSERT INTO users (telegram_id, full_name) VALUES (123, '–ò–≤–∞–Ω');
INSERT INTO shops (user_id, shop_name, pickup_address) 
VALUES ('user-123', '–¶–≤–µ—Ç—ã', '—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10');

-- –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
DELETE FROM users WHERE id = 'user-123';

-- –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
-- ‚úÖ PostgreSQL –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò —É–¥–∞–ª—è–µ—Ç –º–∞–≥–∞–∑–∏–Ω —Å user_id = 'user-123'
-- –ù–µ—Ç "–≤–∏—Å—è—á–∏—Ö" —Å—Å—ã–ª–æ–∫ - –í–°–Å –ß–ò–°–¢–û!
```

## üéØ –î—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã ON DELETE:

### 1. **CASCADE** (—É–¥–∞–ª–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏):
```sql
ON DELETE CASCADE
-- –£–¥–∞–ª–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí —É–¥–∞–ª–∏–ª–∏ –º–∞–≥–∞–∑–∏–Ω
```

### 2. **SET NULL** (–æ–±–Ω—É–ª–∏—Ç—å —Å—Å—ã–ª–∫—É):
```sql
ON DELETE SET NULL
-- –£–¥–∞–ª–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí user_id –≤ shops —Å—Ç–∞–ª NULL
-- –ù–û: —É –Ω–∞—Å user_id NOT NULL, —Ç–∞–∫ —á—Ç–æ —ç—Ç–æ –Ω–µ –ø–æ–¥–æ–π–¥–µ—Ç!
```

### 3. **RESTRICT** (–∑–∞–ø—Ä–µ—Ç–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ):
```sql
ON DELETE RESTRICT
-- –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –µ—Å–ª–∏ —É –Ω–µ–≥–æ –µ—Å—Ç—å –º–∞–≥–∞–∑–∏–Ω
-- –°–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª–∏ –º–∞–≥–∞–∑–∏–Ω, –ø–æ—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

### 4. **NO ACTION** (–Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞—Ç—å, –Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å):
```sql
ON DELETE NO ACTION
-- –ü–æ—Ö–æ–∂–µ –Ω–∞ RESTRICT, –Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–∑–∂–µ
```

## üéØ –ü–æ—á–µ–º—É –º—ã –≤—ã–±—Ä–∞–ª–∏ CASCADE:

**–õ–æ–≥–∏–∫–∞:**
- –ï—Å–ª–∏ —É–¥–∞–ª–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –º–∞–≥–∞–∑–∏–Ω –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω
- –ù–µ—Ç —Å–º—ã—Å–ª–∞ —Ö—Ä–∞–Ω–∏—Ç—å –º–∞–≥–∞–∑–∏–Ω –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–µ—Å–ª–∏ –±—ã —Ö–æ—Ç–µ–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é):**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `is_deleted` —Ñ–ª–∞–≥ –≤–º–µ—Å—Ç–æ DELETE
- –ò–ª–∏ `ON DELETE SET NULL` (–Ω–æ —Ç–æ–≥–¥–∞ user_id –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å nullable)

---

# DECIMAL - —Ç–æ—á–Ω—ã–µ —á–∏—Å–ª–∞

## üéØ –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ:

**DECIMAL** - —ç—Ç–æ —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö –¥–ª—è **—Ç–æ—á–Ω—ã—Ö** –¥–µ—Å—è—Ç–∏—á–Ω—ã—Ö —á–∏—Å–µ–ª (–¥–µ–Ω—å–≥–∏, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã).

**–ü—Ä–æ–±–ª–µ–º–∞ —Å FLOAT/DOUBLE:**
```java
// FLOAT/DOUBLE - –Ω–µ—Ç–æ—á–Ω—ã–µ (–∏–∑-–∑–∞ –¥–≤–æ–∏—á–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è)
double price = 0.1 + 0.2;
System.out.println(price); // 0.30000000000000004 ‚ùå (–Ω–µ—Ç–æ—á–Ω–æ!)
```

**DECIMAL - —Ç–æ—á–Ω—ã–µ:**
```sql
-- DECIMAL –≤—Å–µ–≥–¥–∞ —Ç–æ—á–Ω—ã–π
DECIMAL(10, 2) -- 10 —Ü–∏—Ñ—Ä –≤—Å–µ–≥–æ, 2 –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
-- –ü—Ä–∏–º–µ—Ä: 12345678.90 (—Ç–æ—á–Ω–æ!)
```

## üìù –°–∏–Ω—Ç–∞–∫—Å–∏—Å:

```sql
DECIMAL(precision, scale)
```

**–†–∞–∑–±–æ—Ä:**
- **`precision`** - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏—Ñ—Ä (–¥–æ –∏ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π)
- **`scale`** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏—Ñ—Ä –ü–û–°–õ–ï –∑–∞–ø—è—Ç–æ–π

## üîç –ü—Ä–∏–º–µ—Ä—ã:

### –ü—Ä–∏–º–µ—Ä 1: –î–µ–Ω—å–≥–∏

```sql
price DECIMAL(10, 2)
-- precision = 10 (–≤—Å–µ–≥–æ 10 —Ü–∏—Ñ—Ä)
-- scale = 2 (2 —Ü–∏—Ñ—Ä—ã –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π)

-- –ü—Ä–∏–º–µ—Ä—ã –∑–Ω–∞—á–µ–Ω–∏–π:
12345678.90 ‚úÖ (10 —Ü–∏—Ñ—Ä: 8 –¥–æ –∑–∞–ø—è—Ç–æ–π + 2 –ø–æ—Å–ª–µ)
99999999.99 ‚úÖ (–º–∞–∫—Å–∏–º—É–º)
100000000.00 ‚ùå (11 —Ü–∏—Ñ—Ä - —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ!)
12.5 ‚úÖ (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –∫–∞–∫ 12.50)
```

### –ü—Ä–∏–º–µ—Ä 2: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (–Ω–∞—à–∞ –º–∏–≥—Ä–∞—Ü–∏—è)

```sql
latitude DECIMAL(10, 8)
-- precision = 10 (–≤—Å–µ–≥–æ 10 —Ü–∏—Ñ—Ä)
-- scale = 8 (8 —Ü–∏—Ñ—Ä –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π)

-- –ü—Ä–∏–º–µ—Ä—ã:
55.75581400 ‚úÖ (10 —Ü–∏—Ñ—Ä: 2 –¥–æ –∑–∞–ø—è—Ç–æ–π + 8 –ø–æ—Å–ª–µ)
-90.00000000 ‚úÖ (—é–∂–Ω—ã–π –ø–æ–ª—é—Å)
90.12345678 ‚úÖ (–º–∞–∫—Å–∏–º—É–º)
200.00000000 ‚ùå (—à–∏—Ä–æ—Ç–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å > 90, –Ω–æ DECIMAL —ç—Ç–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç - –Ω—É–∂–µ–Ω CHECK!)

longitude DECIMAL(11, 8)
-- precision = 11 (–¥–æ–ª–≥–æ—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –ø–æ –º–æ–¥—É–ª—é)
-- scale = 8 (8 —Ü–∏—Ñ—Ä –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π)

-- –ü—Ä–∏–º–µ—Ä—ã:
37.61730000 ‚úÖ (–ú–æ—Å–∫–≤–∞)
-180.00000000 ‚úÖ (–ª–∏–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω—ã –¥–∞—Ç)
180.12345678 ‚úÖ (–º–∞–∫—Å–∏–º—É–º)
```

## üéØ –ü–æ—á–µ–º—É DECIMAL –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:

1. **–¢–æ—á–Ω–æ—Å—Ç—å:**
   - FLOAT –º–æ–∂–µ—Ç "–ø–æ—Ç–µ—Ä—è—Ç—å" —Ç–æ—á–Ω–æ—Å—Ç—å (55.75581400 ‚Üí 55.75581399...)
   - DECIMAL –≤—Å–µ–≥–¥–∞ —Ç–æ—á–Ω—ã–π

2. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å:**
   - –í –ë–î –≤–∏–¥–Ω–æ —Ç–æ—á–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (55.75581400)
   - –õ–µ–≥–∫–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å, –∏—Å–∫–∞—Ç—å

3. **–°—Ç–∞–Ω–¥–∞—Ä—Ç:**
   - –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ–±—ã—á–Ω–æ —Ö—Ä–∞–Ω—è—Ç –∫–∞–∫ DECIMAL
   - –°–æ–≤–º–µ—Å—Ç–∏–º–æ —Å –≥–µ–æ–∫–æ–¥–∏–Ω–≥ API (2GIS, –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã)

---

# CHECK constraint - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö

## üéØ –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ:

**CHECK constraint** - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ü–ï–†–ï–î —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î.

**–ê–Ω–∞–ª–æ–≥–∏—è:**
- –ö–∞–∫ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã: "–í–æ–∑—Ä–∞—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 18 –¥–æ 100"
- –ï—Å–ª–∏ –≤–≤–µ–ª 15 ‚Üí –æ—à–∏–±–∫–∞, –Ω–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è

## üìù –°–∏–Ω—Ç–∞–∫—Å–∏—Å:

```sql
CHECK (—É—Å–ª–æ–≤–∏–µ)
```

**–†–∞–∑–±–æ—Ä:**
- **`CHECK`** - –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ
- **`(—É—Å–ª–æ–≤–∏–µ)`** - –ª–æ–≥–∏—á–µ—Å–∫–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å true)

## üîç –ù–∞—à –ø—Ä–∏–º–µ—Ä –∏–∑ –º–∏–≥—Ä–∞—Ü–∏–∏:

```sql
CHECK (
    (latitude IS NULL AND longitude IS NULL) OR
    (latitude BETWEEN -90 AND 90 AND longitude BETWEEN -180 AND 180)
)
```

**–†–∞–∑–±–æ—Ä –ø–æ —á–∞—Å—Ç—è–º:**

### –ß–∞—Å—Ç—å 1: `(latitude IS NULL AND longitude IS NULL)`
- **`IS NULL`** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—É—Å—Ç–æ–µ (NULL)
- **`AND`** - –ª–æ–≥–∏—á–µ—Å–∫–æ–µ "–ò" (–æ–±–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å NULL)
- **–°–º—ã—Å–ª:** "–ï—Å–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã (NULL) ‚Üí OK"

### –ß–∞—Å—Ç—å 2: `OR`
- **`OR`** - –ª–æ–≥–∏—á–µ—Å–∫–æ–µ "–ò–õ–ò"
- **–°–º—ã—Å–ª:** "–ò–õ–ò –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å"

### –ß–∞—Å—Ç—å 3: `(latitude BETWEEN -90 AND 90 AND longitude BETWEEN -180 AND 180)`
- **`BETWEEN X AND Y`** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω (–≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ)
- **`latitude BETWEEN -90 AND 90`** - —à–∏—Ä–æ—Ç–∞ –æ—Ç -90 –¥–æ +90
- **`longitude BETWEEN -180 AND 180`** - –¥–æ–ª–≥–æ—Ç–∞ –æ—Ç -180 –¥–æ +180
- **`AND`** - –æ–±–∞ —É—Å–ª–æ–≤–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å true
- **–°–º—ã—Å–ª:** "–ï—Å–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —É–∫–∞–∑–∞–Ω—ã, –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º–∏"

## üîç –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã:

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:

```sql
-- 1. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —É–∫–∞–∑–∞–Ω—ã (NULL)
latitude = NULL, longitude = NULL
-- ‚úÖ OK (–ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å —É—Å–ª–æ–≤–∏—è: latitude IS NULL AND longitude IS NULL)

-- 2. –í–∞–ª–∏–¥–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ú–æ—Å–∫–≤—ã
latitude = 55.75581400, longitude = 37.61730000
-- ‚úÖ OK (–≤—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å: latitude BETWEEN -90 AND 90 AND longitude BETWEEN -180 AND 180)

-- 3. –í–∞–ª–∏–¥–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (—é–∂–Ω—ã–π –ø–æ–ª—é—Å)
latitude = -90.00000000, longitude = 0.00000000
-- ‚úÖ OK (–≤—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å: –æ–±–∞ –≤ –¥–æ–ø—É—Å—Ç–∏–º–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ)
```

### ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:

```sql
-- 1. –®–∏—Ä–æ—Ç–∞ –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
latitude = 200.00000000, longitude = 37.61730000
-- ‚ùå –û–®–ò–ë–ö–ê! latitude > 90 (–Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É BETWEEN -90 AND 90)

-- 2. –î–æ–ª–≥–æ—Ç–∞ –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
latitude = 55.75581400, longitude = 250.00000000
-- ‚ùå –û–®–ò–ë–ö–ê! longitude > 180 (–Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É BETWEEN -180 AND 180)

-- 3. –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ —É–∫–∞–∑–∞–Ω–∞
latitude = 55.75581400, longitude = NULL
-- ‚ùå –û–®–ò–ë–ö–ê! 
-- –ü–µ—Ä–≤–∞—è —á–∞—Å—Ç—å: latitude IS NULL AND longitude IS NULL ‚Üí false (latitude –Ω–µ NULL)
-- –í—Ç–æ—Ä–∞—è —á–∞—Å—Ç—å: latitude BETWEEN -90 AND 90 AND longitude BETWEEN -180 AND 180 ‚Üí false (longitude NULL)
-- –û–±–µ —á–∞—Å—Ç–∏ false ‚Üí CHECK constraint violation

-- 4. –û–±–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
latitude = 200.00000000, longitude = 250.00000000
-- ‚ùå –û–®–ò–ë–ö–ê! –û–±–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
```

## üéØ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:

1. **–ó–∞—â–∏—Ç–∞ –æ—Ç –º—É—Å–æ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
   - –ù–µ–ª—å–∑—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞ –ú–∞—Ä—Å–µ (latitude = 200)
   - –î–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –≤–∞–ª–∏–¥–Ω—ã–µ

2. **–†–∞–Ω–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫:**
   - –û—à–∏–±–∫–∞ –≤–∏–¥–Ω–∞ —Å—Ä–∞–∑—É –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ (–Ω–µ –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å –≤ –∫–æ–¥–µ)
   - –õ–µ–≥—á–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å

3. **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:**
   - –ï—Å–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —É–∫–∞–∑–∞–Ω—ã, –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª–Ω—ã–º–∏ (–æ–±–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)
   - –ù–µ—Ç "–ø–æ–ª–æ–≤–∏–Ω—á–∞—Ç—ã—Ö" –¥–∞–Ω–Ω—ã—Ö

---

# UNIQUE constraint - —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å

## üéØ –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ:

**UNIQUE** - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º (–Ω–µ –º–æ–∂–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è).

**–ê–Ω–∞–ª–æ–≥–∏—è:**
- –ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞ —É–Ω–∏–∫–∞–ª–µ–Ω (–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–≤—É—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö)
- Email —É–Ω–∏–∫–∞–ª–µ–Ω (–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–≤—É—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –æ–¥–Ω–∏–º email)

## üìù –°–∏–Ω—Ç–∞–∫—Å–∏—Å:

```sql
user_id UUID NOT NULL UNIQUE REFERENCES users(id)
```

**–†–∞–∑–±–æ—Ä:**
- **`UNIQUE`** - –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ
- **–°–º—ã—Å–ª:** "–í —Ç–∞–±–ª–∏—Ü–µ `shops` –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–≤—É—Ö –∑–∞–ø–∏—Å–µ–π —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º `user_id`"

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:

```sql
-- 1. –°–æ–∑–¥–∞–µ–º –º–∞–≥–∞–∑–∏–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 'user-123'
INSERT INTO shops (user_id, shop_name, pickup_address) 
VALUES ('user-123', '–¶–≤–µ—Ç—ã –Ω–∞ –õ–µ–Ω–∏–Ω–∞', '—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10');
-- ‚úÖ OK

-- 2. –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –≤—Ç–æ—Ä–æ–π –º–∞–≥–∞–∑–∏–Ω –¥–ª—è —Ç–æ–≥–æ –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
INSERT INTO shops (user_id, shop_name, pickup_address) 
VALUES ('user-123', '–¶–≤–µ—Ç—ã –Ω–∞ –ú–∏—Ä–∞', '–ø—Ä. –ú–∏—Ä–∞, –¥. 25');
-- ‚ùå –û–®–ò–ë–ö–ê! UNIQUE constraint violation
-- PostgreSQL: "user_id 'user-123' —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ shops"
```

### ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (—Ä–∞–∑–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏):

```sql
-- 1. –ú–∞–≥–∞–∑–∏–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 'user-123'
INSERT INTO shops (user_id, shop_name, pickup_address) 
VALUES ('user-123', '–¶–≤–µ—Ç—ã –Ω–∞ –õ–µ–Ω–∏–Ω–∞', '—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10');
-- ‚úÖ OK

-- 2. –ú–∞–≥–∞–∑–∏–Ω –¥–ª—è –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 'user-456'
INSERT INTO shops (user_id, shop_name, pickup_address) 
VALUES ('user-456', '–†–æ–∑–∞ –∏ –õ–∏–ª–∏–∏', '—É–ª. –ü—É—à–∫–∏–Ω–∞, –¥. 5');
-- ‚úÖ OK (—Ä–∞–∑–Ω—ã–µ user_id, —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞—Ä—É—à–µ–Ω–∞)
```

## üéØ –ó–∞—á–µ–º —ç—Ç–æ –Ω—É–∂–Ω–æ:

1. **–õ–æ–≥–∏–∫–∞ –±–∏–∑–Ω–µ—Å–∞:**
   - –û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –æ–¥–∏–Ω –º–∞–≥–∞–∑–∏–Ω (1:1 —Å–≤—è–∑—å)
   - –ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–≤—É—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤ –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

2. **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:**
   - –ù–µ–ª—å–∑—è —Å–ª—É—á–∞–π–Ω–æ —Å–æ–∑–¥–∞—Ç—å –¥–≤–∞ –º–∞–≥–∞–∑–∏–Ω–∞ –¥–ª—è –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –î–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã

3. **–£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–¥–∞:**
   - –ù–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å "–∞ –µ—Å—Ç—å –ª–∏ —É–∂–µ –º–∞–≥–∞–∑–∏–Ω?"
   - –ü—Ä–æ—Å—Ç–æ –∏—â–µ—à—å –ø–æ `user_id` ‚Üí –≤—Å–µ–≥–¥–∞ –Ω–∞–π–¥–µ—à—å –º–∞–∫—Å–∏–º—É–º –æ–¥–∏–Ω

---

# –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

## üéØ –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ:

**–°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å** - —ç—Ç–æ –∏–Ω–¥–µ–∫—Å –Ω–∞ –ù–ï–°–ö–û–õ–¨–ö–û –ø–æ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

**–ê–Ω–∞–ª–æ–≥–∏—è:**
- –û–±—ã—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å = –∞–ª—Ñ–∞–≤–∏—Ç–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å –ø–æ —Ñ–∞–º–∏–ª–∏–∏
- –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å = —É–∫–∞–∑–∞—Ç–µ–ª—å –ø–æ —Ñ–∞–º–∏–ª–∏–∏ + –∏–º–µ–Ω–∏ (—Å–Ω–∞—á–∞–ª–∞ —Ñ–∞–º–∏–ª–∏—è, –ø–æ—Ç–æ–º –∏–º—è)

## üìù –°–∏–Ω—Ç–∞–∫—Å–∏—Å:

```sql
CREATE INDEX idx_shops_coordinates ON shops(latitude, longitude);
```

**–†–∞–∑–±–æ—Ä:**
- **`idx_shops_coordinates`** - –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞
- **`shops(latitude, longitude)`** - –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—è (–≤ –ø–æ—Ä—è–¥–∫–µ –≤–∞–∂–Ω–æ—Å—Ç–∏!)

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### –ü—Ä–∏–º–µ—Ä 1: –ü–æ–∏—Å–∫ –ø–æ –û–ë–û–ò–ú –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º (–±—ã—Å—Ç—Ä–æ):

```sql
-- –ó–∞–ø—Ä–æ—Å: –Ω–∞–π—Ç–∏ –º–∞–≥–∞–∑–∏–Ω—ã –≤ —Ä–∞–π–æ–Ω–µ –ú–æ—Å–∫–≤—ã
SELECT * FROM shops 
WHERE latitude BETWEEN 55.7 AND 55.8 
  AND longitude BETWEEN 37.6 AND 37.7;

-- –° —Å–æ—Å—Ç–∞–≤–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º:
-- ‚úÖ PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å idx_shops_coordinates
-- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ (–¥–∞–∂–µ –µ—Å–ª–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –º–∏–ª–ª–∏–æ–Ω)
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ latitude (–±—ã—Å—Ç—Ä–æ):

```sql
-- –ó–∞–ø—Ä–æ—Å: –Ω–∞–π—Ç–∏ –º–∞–≥–∞–∑–∏–Ω—ã –Ω–∞ —à–∏—Ä–æ—Ç–µ –ú–æ—Å–∫–≤—ã
SELECT * FROM shops 
WHERE latitude BETWEEN 55.7 AND 55.8;

-- –° —Å–æ—Å—Ç–∞–≤–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º:
-- ‚úÖ PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å (–ø–æ –ø–µ—Ä–≤–æ–π –∫–æ–ª–æ–Ω–∫–µ latitude)
-- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫
```

### –ü—Ä–∏–º–µ—Ä 3: –ü–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ longitude (–ú–ï–î–õ–ï–ù–ù–û):

```sql
-- –ó–∞–ø—Ä–æ—Å: –Ω–∞–π—Ç–∏ –º–∞–≥–∞–∑–∏–Ω—ã –Ω–∞ –¥–æ–ª–≥–æ—Ç–µ –ú–æ—Å–∫–≤—ã
SELECT * FROM shops 
WHERE longitude BETWEEN 37.6 AND 37.7;

-- –° —Å–æ—Å—Ç–∞–≤–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º:
-- ‚ùå PostgreSQL –ù–ï –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ
-- ‚ùå –ü—Ä–∏–¥–µ—Ç—Å—è –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤—Å–µ —Å—Ç—Ä–æ–∫–∏ (–º–µ–¥–ª–µ–Ω–Ω–æ!)
-- –ü–æ—á–µ–º—É: –∏–Ω–¥–µ–∫—Å —É–ø–æ—Ä—è–¥–æ—á–µ–Ω —Å–Ω–∞—á–∞–ª–∞ –ø–æ latitude, –ø–æ—Ç–æ–º –ø–æ longitude
-- –ï—Å–ª–∏ –∏—â–µ—à—å —Ç–æ–ª—å–∫–æ –ø–æ longitude ‚Üí –∏–Ω–¥–µ–∫—Å –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç
```

## üéØ –ü—Ä–∞–≤–∏–ª–æ —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤:

**–ò–Ω–¥–µ–∫—Å —É–ø–æ—Ä—è–¥–æ—á–µ–Ω —Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ:**
- `(latitude, longitude)` —É–ø–æ—Ä—è–¥–æ—á–µ–Ω —Å–Ω–∞—á–∞–ª–∞ –ø–æ `latitude`, –ø–æ—Ç–æ–º –ø–æ `longitude`
- –ü–æ–∏—Å–∫ –ø–æ `latitude` ‚Üí –±—ã—Å—Ç—Ä–æ ‚úÖ
- –ü–æ–∏—Å–∫ –ø–æ `latitude + longitude` ‚Üí –±—ã—Å—Ç—Ä–æ ‚úÖ
- –ü–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ `longitude` ‚Üí –º–µ–¥–ª–µ–Ω–Ω–æ ‚ùå

**–†–µ—à–µ–Ω–∏–µ (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω –ø–æ–∏—Å–∫ —Ç–æ–ª—å–∫–æ –ø–æ longitude):**
```sql
-- –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å
CREATE INDEX idx_shops_longitude ON shops(longitude);
```

## üéØ –ü–æ—á–µ–º—É –º—ã —Å–æ–∑–¥–∞–ª–∏ —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å:

1. **–ì–µ–æ–ø–æ–∏—Å–∫:**
   - –û–±—ã—á–Ω–æ –∏—â–µ–º –ø–æ –û–ë–û–ò–ú –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º (–≤ —Ä–∞–¥–∏—É—Å–µ –æ—Ç —Ç–æ—á–∫–∏)
   - –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–π –ø–æ–∏—Å–∫

2. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:**
   - –û–¥–∏–Ω –∏–Ω–¥–µ–∫—Å –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö (—ç–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞)
   - –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –æ–±–µ–∏–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º

---

# –°–≤—è–∑—å 1:1 vs 1:Many

## üéØ –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ:

**–°–≤—è–∑—å –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏** - —ç—Ç–æ –∫–∞–∫ —Å–≤—è–∑–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö.

### 1:1 (–û–¥–∏–Ω –∫ –æ–¥–Ω–æ–º—É)

**–û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –æ–¥–∏–Ω –º–∞–≥–∞–∑–∏–Ω**

```sql
-- –¢–∞–±–ª–∏—Ü–∞ shops
user_id UUID UNIQUE REFERENCES users(id)
-- UNIQUE –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç: –æ–¥–∏–Ω user_id = –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å –≤ shops
```

**–ü—Ä–∏–º–µ—Ä:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å '–ò–≤–∞–Ω' ‚Üí –æ–¥–∏–Ω –º–∞–≥–∞–∑–∏–Ω '–¶–≤–µ—Ç—ã –Ω–∞ –õ–µ–Ω–∏–Ω–∞'
- –ù–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–≤—É—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤ –¥–ª—è '–ò–≤–∞–Ω–∞'

### 1:Many (–û–¥–∏–Ω –∫–æ –º–Ω–æ–≥–∏–º)

**–û–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –º–Ω–æ–≥–æ –∑–∞–∫–∞–∑–æ–≤**

```sql
-- –¢–∞–±–ª–∏—Ü–∞ orders (–±—É–¥–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏)
user_id UUID REFERENCES users(id)  -- –ë–ï–ó UNIQUE!
-- –ë–ï–ó UNIQUE –æ–∑–Ω–∞—á–∞–µ—Ç: –æ–¥–∏–Ω user_id = –º–Ω–æ–≥–æ –∑–∞–ø–∏—Å–µ–π –≤ orders
```

**–ü—Ä–∏–º–µ—Ä:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å '–ò–≤–∞–Ω' ‚Üí –∑–∞–∫–∞–∑ #1, –∑–∞–∫–∞–∑ #2, –∑–∞–∫–∞–∑ #3...
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –º–Ω–æ–≥–æ –∑–∞–∫–∞–∑–æ–≤ –¥–ª—è '–ò–≤–∞–Ω–∞'

## üîç –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:

### 1:1 (shops ‚Üî users):
```
users              shops
------             ------
id: 'user-123'  ‚Üí  user_id: 'user-123' (UNIQUE)
id: 'user-456'  ‚Üí  user_id: 'user-456' (UNIQUE)
id: 'user-789'  ‚Üí  (–Ω–µ—Ç –º–∞–≥–∞–∑–∏–Ω–∞)
```

### 1:Many (orders ‚Üî users):
```
users              orders
------             ------
id: 'user-123'  ‚Üí  user_id: 'user-123' (–∑–∞–∫–∞–∑ #1)
                   user_id: 'user-123' (–∑–∞–∫–∞–∑ #2)
                   user_id: 'user-123' (–∑–∞–∫–∞–∑ #3)
id: 'user-456'  ‚Üí  user_id: 'user-456' (–∑–∞–∫–∞–∑ #1)
```

## üéØ –ö–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø —Å–≤—è–∑–∏:

1. **–°–ø—Ä–æ—Å–∏ —Å–µ–±—è:**
   - "–°–∫–æ–ª—å–∫–æ –º–∞–≥–∞–∑–∏–Ω–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å —É –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?" ‚Üí –û–¥–∏–Ω ‚Üí 1:1
   - "–°–∫–æ–ª—å–∫–æ –∑–∞–∫–∞–∑–æ–≤ –º–æ–∂–µ—Ç –±—ã—Ç—å —É –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?" ‚Üí –ú–Ω–æ–≥–æ ‚Üí 1:Many

2. **–ü—Ä–æ–≤–µ—Ä—å UNIQUE:**
   - –ï—Å—Ç—å `UNIQUE` ‚Üí 1:1
   - –ù–µ—Ç `UNIQUE` ‚Üí 1:Many

---

# –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã

## –ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞

```sql
-- 1. –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
INSERT INTO users (telegram_id, full_name, role) 
VALUES (123456789, '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤', 'SHOP');
-- –ü–æ–ª—É—á–∏–ª–∏ id = 'abc-123-def-456'

-- 2. –°–æ–∑–¥–∞–µ–º –º–∞–≥–∞–∑–∏–Ω –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
INSERT INTO shops (
    user_id,
    shop_name,
    pickup_address,
    latitude,
    longitude,
    phone,
    is_active
) VALUES (
    'abc-123-def-456',           -- user_id (FOREIGN KEY)
    '–¶–≤–µ—Ç—ã –Ω–∞ –õ–µ–Ω–∏–Ω–∞',            -- shop_name
    '—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10, –æ—Ñ–∏—Å 5', -- pickup_address
    55.75581400,                  -- latitude (–ú–æ—Å–∫–≤–∞)
    37.61730000,                  -- longitude (–ú–æ—Å–∫–≤–∞)
    '+79991234567',              -- phone
    false                         -- is_active (–ø–æ–∫–∞ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω)
);
-- ‚úÖ –†–ê–ë–û–¢–ê–ï–¢! –í—Å–µ –¥–∞–Ω–Ω—ã–µ –≤–∞–ª–∏–¥–Ω—ã
```

## –ü—Ä–∏–º–µ—Ä 2: –û—à–∏–±–∫–∞ FOREIGN KEY

```sql
-- –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
INSERT INTO shops (user_id, shop_name, pickup_address) 
VALUES ('–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π-id', '–¶–≤–µ—Ç—ã', '—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10');
-- ‚ùå –û–®–ò–ë–ö–ê: FOREIGN KEY constraint violation
-- PostgreSQL: "user_id '–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π-id' –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ users"
```

## –ü—Ä–∏–º–µ—Ä 3: –û—à–∏–±–∫–∞ UNIQUE

```sql
-- 1. –°–æ–∑–¥–∞–µ–º –ø–µ—Ä–≤—ã–π –º–∞–≥–∞–∑–∏–Ω
INSERT INTO shops (user_id, shop_name, pickup_address) 
VALUES ('user-123', '–¶–≤–µ—Ç—ã –Ω–∞ –õ–µ–Ω–∏–Ω–∞', '—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10');
-- ‚úÖ OK

-- 2. –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –≤—Ç–æ—Ä–æ–π –º–∞–≥–∞–∑–∏–Ω –¥–ª—è —Ç–æ–≥–æ –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
INSERT INTO shops (user_id, shop_name, pickup_address) 
VALUES ('user-123', '–¶–≤–µ—Ç—ã –Ω–∞ –ú–∏—Ä–∞', '–ø—Ä. –ú–∏—Ä–∞, –¥. 25');
-- ‚ùå –û–®–ò–ë–ö–ê: UNIQUE constraint violation
-- PostgreSQL: "user_id 'user-123' —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ shops"
```

## –ü—Ä–∏–º–µ—Ä 4: –û—à–∏–±–∫–∞ CHECK constraint

```sql
-- –ü—ã—Ç–∞–µ–º—Å—è —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
INSERT INTO shops (
    user_id,
    shop_name,
    pickup_address,
    latitude,
    longitude
) VALUES (
    'user-123',
    '–¶–≤–µ—Ç—ã',
    '—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10',
    200.00000000,  -- ‚ùå —à–∏—Ä–æ—Ç–∞ > 90 (–Ω–µ–≤–∞–ª–∏–¥–Ω–æ!)
    37.61730000
);
-- ‚ùå –û–®–ò–ë–ö–ê: CHECK constraint violation
-- PostgreSQL: "latitude –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–µ–∂–¥—É -90 –∏ 90"
```

---

## üéØ –ò–¢–û–ì–û:

1. **FOREIGN KEY** - —Å–≤—è–∑—å –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç "–≤–∏—Å—è—á–∏—Ö" —Å—Å—ã–ª–æ–∫)
2. **ON DELETE CASCADE** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
3. **DECIMAL** - —Ç–æ—á–Ω—ã–µ —á–∏—Å–ª–∞ (–¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç, –¥–µ–Ω–µ–≥)
4. **CHECK constraint** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º
5. **UNIQUE** - —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è (1:1 —Å–≤—è–∑—å)
6. **–°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã** - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø–æ–ª—è–º

**–í—Å—ë —ç—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è:**
- –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö (–Ω–µ—Ç "–º—É—Å–æ—Ä–Ω—ã—Ö" –∑–∞–ø–∏—Å–µ–π)
- –ë—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ (–∏–Ω–¥–µ–∫—Å—ã)
- –ó–∞—â–∏—Ç—ã –æ—Ç –æ—à–∏–±–æ–∫ (CHECK, FOREIGN KEY)

---

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `Shop` –≤ Java (JPA Entity) üöÄ
