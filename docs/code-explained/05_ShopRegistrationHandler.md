# –¢–û–¢–ê–õ–¨–ù–´–ô –†–ê–ó–ë–û–†: ShopRegistrationHandler.java
## –ö–∞–∫ –±–æ—Ç –ø–æ—à–∞–≥–æ–≤–æ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –º–∞–≥–∞–∑–∏–Ω

> **–£—Ä–æ–≤–µ–Ω—å**: "–•–æ—á—É –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫ –±–æ—Ç –ø–∏–∑–¥–∏—Ç –º–æ–∑–≥ –º–∞–≥–∞–∑–∏–Ω—É: '–≤–≤–µ–¥–∏ –∏–º—è, –≤–≤–µ–¥–∏ –∞–¥—Ä–µ—Å, –¥–∞–π –Ω–æ–º–µ—Ä'"  
> **–¶–µ–ª—å**: –ü–æ–Ω—è—Ç—å –≤–µ—Å—å —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞ —á–µ—Ä–µ–∑ Telegram ‚Äî –æ—Ç –ø–µ—Ä–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ –∑–∞–ø–∏—Å–∏ –≤ –ë–î  
> **–°—Ç–∏–ª—å**: –∫–∞–∫ –±—É–¥—Ç–æ –æ–±—ä—è—Å–Ω—è—é —Ç–µ–±–µ, –ø–æ–∫–∞ —Ç—ã –∂–º—ë—à—å –∫–Ω–æ–ø–∫–∏ –≤ Telegram –∏ –æ—Ä—ë—à—å "–ê –≠–¢–û –ö–¢–û –û–ë–†–ê–ë–ê–¢–´–í–ê–ï–¢?"

---

## –ì–¥–µ —ç—Ç–æ—Ç —Ö–µ–Ω–¥–ª–µ—Ä –≤ –æ–±—â–µ–π –∫–∞—Ä—Ç–∏–Ω–µ

–°–µ–π—á–∞—Å –ø—É—Ç—å —Ç–∞–∫–æ–π:

```text
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Telegram ‚Üí Bot ‚Üí ShopRegistrationHandler ‚Üí ShopService ‚Üí ShopRepository ‚Üí –ë–î (shops)
```

`ShopRegistrationHandler` ‚Äî —ç—Ç–æ –∏–º–µ–Ω–Ω–æ –¥–∏–∞–ª–æ–≥–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:

- —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ `telegramId`,
- –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å—ã –ø–æ —à–∞–≥–∞–º,
- —Å–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ (`–Ω–∞–∑–≤–∞–Ω–∏–µ`, `–∞–¥—Ä–µ—Å`, `—Ç–µ–ª–µ—Ñ–æ–Ω`),
- –≤ –∫–æ–Ω—Ü–µ –≤—ã–∑—ã–≤–∞–µ—Ç `ShopService.createShopForUser(...)`.

–û–Ω **–Ω–µ –∑–Ω–∞–µ—Ç SQL**, **–Ω–µ –∑–Ω–∞–µ—Ç** –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π —Ç–∞–±–ª–∏—Ü ‚Äî –æ–Ω –ø—Ä–æ—Å—Ç–æ:

- –æ–±—â–∞–µ—Ç—Å—è —Å —é–∑–µ—Ä–æ–º,
- –¥–µ—Ä–≥–∞–µ—Ç —Å–µ—Ä–≤–∏—Å.

---

## –ü–æ–ª–Ω—ã–π –∫–æ–¥ –¥–ª—è –æ—Ä–∏–µ–Ω—Ç–∏—Ä–∞

```java
package org.example.flower_delivery.handler;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.example.flower_delivery.Bot;
import org.example.flower_delivery.model.RegistrationState;
import org.example.flower_delivery.model.Shop;
import org.example.flower_delivery.model.ShopRegistrationData;
import org.example.flower_delivery.service.ShopService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Lazy;
import org.springframework.stereotype.Component;
import org.telegram.telegrambots.meta.api.methods.send.SendMessage;
import org.telegram.telegrambots.meta.api.objects.Contact;
import org.telegram.telegrambots.meta.api.objects.Update;
import org.telegram.telegrambots.meta.api.objects.replykeyboard.InlineKeyboardMarkup;
import org.telegram.telegrambots.meta.api.objects.replykeyboard.ReplyKeyboardMarkup;
import org.telegram.telegrambots.meta.api.objects.replykeyboard.ReplyKeyboardRemove;
import org.telegram.telegrambots.meta.api.objects.replykeyboard.buttons.InlineKeyboardButton;
import org.telegram.telegrambots.meta.api.objects.replykeyboard.buttons.KeyboardButton;
import org.telegram.telegrambots.meta.api.objects.replykeyboard.buttons.KeyboardRow;
import org.telegram.telegrambots.meta.exceptions.TelegramApiException;

import java.util.List;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

/**
 * –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ—à–∞–≥–æ–≤–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞.
 *
 * –£–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∏–∞–ª–æ–≥–æ–º:
 * 1. /register_shop ‚Üí —Å–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ
 * 2. –Æ–∑–µ—Ä –≤–≤–æ–¥–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ ‚Üí —Å–ø—Ä–∞—à–∏–≤–∞–µ–º –∞–¥—Ä–µ—Å
 * 3. –Æ–∑–µ—Ä –≤–≤–æ–¥–∏—Ç –∞–¥—Ä–µ—Å ‚Üí —Å–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω
 * 4. –Æ–∑–µ—Ä –≤–≤–æ–¥–∏—Ç —Ç–µ–ª–µ—Ñ–æ–Ω ‚Üí —Å–æ–∑–¥–∞—ë–º –º–∞–≥–∞–∑–∏–Ω
 */
@Slf4j
@Component
@RequiredArgsConstructor
public class ShopRegistrationHandler {

    private final ShopService shopService;

    @Autowired
    @Lazy
    private Bot bot;

    /**
     * –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.
     * –ö–ª—é—á: telegramId –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     * –ó–Ω–∞—á–µ–Ω–∏–µ: –¥–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (—Ç–µ–∫—É—â–∏–π —à–∞–≥ + –≤–≤–µ–¥—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
     *
     * ConcurrentHashMap ‚Äî –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π, —Ç.–∫. Telegram –º–æ–∂–µ—Ç —Å–ª–∞—Ç—å
     * —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —Ä–∞–∑–Ω—ã—Ö —é–∑–µ—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
     */
    private final Map<Long, ShopRegistrationData> registrationDataMap = new ConcurrentHashMap<>();

    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –Ω–∏–∂–µ
}
```

–î–∞–ª—å—à–µ —Ä–∞–∑–±–µ—Ä—ë–º –ø–æ –±–ª–æ–∫–∞–º.

---

# 1. –ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```java
@Slf4j
@Component
@RequiredArgsConstructor
public class ShopRegistrationHandler {
```

- `@Component` ‚Äî –≥–æ–≤–æ—Ä–∏–º Spring:
  - "–°–æ–∑–¥–∞–π –±–∏–Ω `shopRegistrationHandler` –∏ —É–ø—Ä–∞–≤–ª—è–π –µ–≥–æ –∂–∏–∑–Ω—å—é".
- `@RequiredArgsConstructor`:
  - –≥–µ–Ω–µ—Ä–∏—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –¥–ª—è –≤—Å–µ—Ö `final` –ø–æ–ª–µ–π (`shopService`, `registrationDataMap`).
  - Spring —á–µ—Ä–µ–∑ —ç—Ç–æ—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∑–∞–∏–Ω–∂–µ–∫—Ç–∏—Ç `ShopService`.
- `@Slf4j`:
  - –¥–∞—ë—Ç –ø–æ–ª–µ `log`, —á—Ç–æ–±—ã –ø–∏—Å–∞—Ç—å –≤ –ª–æ–≥–∏: `log.info(...)`, `log.debug(...)`.

–ü–æ–ª—è:

```java
private final ShopService shopService;

@Autowired
@Lazy
private Bot bot;
```

- `shopService` ‚Äî –º—ã —á–µ—Ä–µ–∑ –Ω–µ–≥–æ —Å–æ–∑–¥–∞—ë–º –º–∞–≥–∞–∑–∏–Ω—ã –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –æ–Ω–∏ –∏–ª–∏ –Ω–µ—Ç.
- `bot` ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ –≥–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å –±–æ—Ç–∞, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤—ã–∑—ã–≤–∞—Ç—å `bot.execute(...)` –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è.
  - `@Lazy` ‚Äî —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
    - `Bot` —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `ShopRegistrationHandler`,
    - `ShopRegistrationHandler` ‚Äî –Ω–∞ `Bot`.
  - `@Autowired` –Ω–∞ –ø–æ–ª–µ ‚Äî Spring –ø–æ–¥—Å—Ç–∞–≤–∏—Ç –ø—Ä–æ–∫—Å–∏ `Bot` –ª–µ–Ω–∏–≤–æ.

–•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π:

```java
private final Map<Long, ShopRegistrationData> registrationDataMap = new ConcurrentHashMap<>();
```

- `Map<Long, ShopRegistrationData>`:
  - –∫–ª—é—á ‚Äî `telegramId` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,
  - –∑–Ω–∞—á–µ–Ω–∏–µ ‚Äî –æ–±—ä–µ–∫—Ç —Å —Ç–µ–∫—É—â–∏–º —à–∞–≥–æ–º –∏ –≤–≤–µ–¥—ë–Ω–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ (`ShopRegistrationData`).
- `ConcurrentHashMap` ‚Äî –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –º–∞–ø–∞:
  - Telegram –º–æ–∂–µ—Ç —Å–ª–∞—Ç—å –∞–ø–¥–µ–π—Ç—ã –æ—Ç —Ä–∞–∑–Ω—ã—Ö —é–∑–µ—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ,
  - –ë–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ—Ç–æ–∫–∞—Ö ‚Üí –Ω—É–∂–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞.

---

# 2. –°—Ç–∞—Ä—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–æ–º–∞–Ω–¥–µ `/register_shop`

–¢–µ–ø–µ—Ä—å —Ä–∞–∑–±–µ—Ä—ë–º –ø—Ä—è–º–æ **–ø–æ —Å–ª–æ–≤–∞–º**, —á—Ç–æ —Ç–∞–º –∑–∞ `update.getMessage().getChatId()`.

–ú–µ—Ç–æ–¥:

```java
public void startRegistration(Update update) {
    Long chatId = update.getMessage().getChatId();
    Long telegramId = update.getMessage().getFrom().getId();

    log.info("–ù–∞—á–∞–ª–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞: telegramId={}", telegramId);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ –º–∞–≥–∞–∑–∏–Ω–∞ —É —ç—Ç–æ–≥–æ —é–∑–µ—Ä–∞
    if (shopService.findByUserTelegramId(telegramId).isPresent()) {
        sendMessage(chatId, "‚ùå –£ —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω!");
        return;
    }

    // –°–æ–∑–¥–∞—ë–º –¥–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ —Å—Ç–∞–≤–∏–º –ø–µ—Ä–≤—ã–π —à–∞–≥
    ShopRegistrationData data = new ShopRegistrationData();
    data.setState(RegistrationState.WAITING_SHOP_NAME);
    registrationDataMap.put(telegramId, data);

    sendMessage(chatId, "üè™ *–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞*\n\n" +
            "–®–∞–≥ 1 –∏–∑ 3\n" +
            "–í–≤–µ–¥–∏—Ç–µ *–Ω–∞–∑–≤–∞–Ω–∏–µ* –≤–∞—à–µ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞:");
}
```

–†–∞–∑–±–∏—Ä–∞–µ–º –ø–æ –∫–∏—Ä–ø–∏—á–∞–º.

### –ß—Ç–æ —Ç–∞–∫–æ–µ `Update`

```java
public void startRegistration(Update update) {
```

- `Update` ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Å –∏–∑ TelegramBots‚Äë–±–∏–±–ª–∏–æ—Ç–µ–∫–∏.
- **Update = "—Å–æ–±—ã—Ç–∏–µ" –∏–∑ Telegram.**

–ü—Ä–∏–º–µ—Ä—ã, —á–µ–º –º–æ–∂–µ—Ç –±—ã—Ç—å `Update`:

- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—Å–ª–∞–ª —Ç–µ–∫—Å—Ç `"–ü—Ä–∏–≤–µ—Ç"`,
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É,
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—Å–ª–∞–ª –∫–æ–Ω—Ç–∞–∫—Ç,
- –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏—Å–ª–∞–ª —Ñ–æ—Ç–æ –∏ —Ç.–¥.

–ê–Ω–∞–ª–æ–≥–∏—è:

- Telegram –∫–∏–¥–∞–µ—Ç —Ç–µ–±–µ –∫–æ–Ω–≤–µ—Ä—Ç —Å –∫—É—á–µ–π –±—É–º–∞–∂–µ–∫.
- –ö–ª–∞—Å—Å `Update` ‚Äî —ç—Ç–æ —ç—Ç–æ—Ç –∫–æ–Ω–≤–µ—Ä—Ç.
- –í–Ω—É—Ç—Ä–∏ –º–æ–≥—É—Ç –±—ã—Ç—å:
  - `message` ‚Äî –µ—Å–ª–∏ –ø—Ä–∏—à–ª–æ –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ,
  - `callbackQuery` ‚Äî –µ—Å–ª–∏ –Ω–∞–∂–∞–ª–∏ inline‚Äë–∫–Ω–æ–ø–∫—É,
  - `editedMessage` ‚Äî –µ—Å–ª–∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ,
  - –∏ —Ç.–¥.

–í –Ω–∞—à–µ–º –º–µ—Ç–æ–¥–µ –º—ã –æ–∂–∏–¥–∞–µ–º, —á—Ç–æ:

- —Å—é–¥–∞ –ø–æ–ø–∞–¥–∞–µ—Ç `Update`, –≤ –∫–æ—Ç–æ—Ä–æ–º **–µ—Å—Ç—å –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** (`update.getMessage()`).

### `update.getMessage()`

```java
Long chatId = update.getMessage().getChatId();
```

- `getMessage()` ‚Äî –º–µ—Ç–æ–¥ `Update`, –∫–æ—Ç–æ—Ä—ã–π:
  - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç `Message`,
  - **–µ—Å–ª–∏ –≤ —ç—Ç–æ–º –∞–ø–¥–µ–π—Ç–µ –≤–æ–æ–±—â–µ –µ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ**.
- `Message` ‚Äî —ç—Ç–æ —É–∂–µ "–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –±—É–º–∞–∂–∫–∞" –≤ –∫–æ–Ω–≤–µ—Ä—Ç–µ:
  - —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è,
  - –∫—Ç–æ –µ–≥–æ –æ—Ç–ø—Ä–∞–≤–∏–ª (`from`),
  - id —á–∞—Ç–∞ (`chat`),
  - –∫–æ–Ω—Ç–∞–∫—Ç/—Ñ–æ—Ç–æ/–¥–æ–∫—É–º–µ–Ω—Ç –∏ —Ç.–¥.

–ï—Å–ª–∏ –±—ã –º—ã –ø–æ–∑–≤–∞–ª–∏ `update.getMessage()` –Ω–∞ –∞–ø–¥–µ–π—Ç–µ, –≥–¥–µ –ù–ï–¢ —Å–æ–æ–±—â–µ–Ω–∏—è
(–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏–ª–µ—Ç–µ–ª —Ç–æ–ª—å–∫–æ `callbackQuery`), —Ç–æ —Ç–∞–º –±—É–¥–µ—Ç `null`,
–∏ –¥–∞–ª—å—à–µ –ª—é–±–æ–µ `get...()` –æ—Ç —ç—Ç–æ–≥–æ ‚Äî `NullPointerException`.

–ù–æ —Å—é–¥–∞ –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ `Bot`, –≥–¥–µ —É–∂–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –µ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ.

### `getChatId()` ‚Äî –æ—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è `chatId`

```java
Long chatId = update.getMessage().getChatId();
```

–†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –ø–æ —à–∞–≥–∞–º:

- `update` ‚Äî –∫–æ–Ω–≤–µ—Ä—Ç.
- `update.getMessage()` ‚Äî –¥–æ—Å—Ç–∞—ë–º –±—É–º–∞–∂–∫—É `Message`.
- `getChatId()` ‚Äî –∏–∑ `Message` –±–µ—Ä—ë–º ID —á–∞—Ç–∞, –∫—É–¥–∞ –Ω—É–∂–Ω–æ –û–¢–í–ï–ß–ê–¢–¨.

–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:

- –í Telegram –±–æ—Ç –Ω–µ –ø–∏—à–µ—Ç "–≤ –Ω–∏–∫—É–¥–∞", –æ–Ω –≤—Å–µ–≥–¥–∞ –æ—Ç–≤–µ—á–∞–µ—Ç **–≤ –∫–∞–∫–æ–π‚Äë—Ç–æ —á–∞—Ç**:
  - –ª–∏—á–∫–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º,
  - –≥—Ä—É–ø–ø–∞,
  - –∫–∞–Ω–∞–ª.
- `chatId` ‚Äî —ç—Ç–æ –∫–∞–∫ –∞–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è –Ω–∞ –∫–æ–Ω–≤–µ—Ä—Ç–µ.

–ï—Å–ª–∏ –±—ã –º—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ `chatId`, –∞ –ø—ã—Ç–∞–ª–∏—Å—å –ø–∏—Å–∞—Ç—å "–∫—É–¥–∞‚Äë—Ç–æ" ‚Äî Telegram –±—ã –ø–æ—Å–ª–∞–ª –Ω–∞—Å –Ω–∞—Ö–µ—Ä.

### `getFrom().getId()` ‚Äî –æ—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è `telegramId`

```java
Long telegramId = update.getMessage().getFrom().getId();
```

–†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º:

- `update.getMessage()` ‚Äî –æ–±—ä–µ–∫—Ç `Message`.
- `.getFrom()` ‚Äî **–∫—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª** —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ.
  - –ö–ª–∞—Å—Å `User` –∏–∑ TelegramBots (–ù–ï –Ω–∞—à `model.User`).
- `.getId()` ‚Äî Telegram‚ÄëID —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ).

–ê–Ω–∞–ª–æ–≥–∏—è:

- `chatId` ‚Äî –Ω–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã, –∫—É–¥–∞ –º—ã –ø–∏—à–µ–º.
- `from.id` (`telegramId`) ‚Äî –∏–º—è —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–º –ø–∏—à–µ—Ç (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –≤–æ –≤—Å—ë–º Telegram).

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º:

- `chatId` ‚Äî –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤,
- `telegramId` ‚Äî –∫–∞–∫ –∫–ª—é—á –≤ –ë–î –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `users`, `shops` –∏ —Ç.–¥.

### –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –º–µ—Ç–æ–¥–∞

–¢–µ–ø–µ—Ä—å —É–∂–µ –±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –∑–Ω–∞—á–∏—Ç:

1. –î–æ—Å—Ç–∞–ª–∏ `chatId` –∏ `telegramId` –∏–∑ `Update`.
2. –õ–æ–≥–∏—Ä—É–µ–º:

```java
log.info("–ù–∞—á–∞–ª–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞: telegramId={}", telegramId);
```

3. –ß–µ—Ä–µ–∑ `shopService.findByUserTelegramId(telegramId)` –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –º–∞–≥–∞–∑–∏–Ω:
   - `Optional.isPresent()` ‚Üí —É–∂–µ –µ—Å—Ç—å ‚Üí —à–ª—ë–º:

   ```java
   sendMessage(chatId, "‚ùå –£ —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω!");
   return;
   ```

4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

```java
ShopRegistrationData data = new ShopRegistrationData();
data.setState(RegistrationState.WAITING_SHOP_NAME);
registrationDataMap.put(telegramId, data);
```

- –í `registrationDataMap` –ø–æ –∫–ª—é—á—É `telegramId` –∫–ª–∞–¥—ë–º –æ–±—ä–µ–∫—Ç,
  –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Ö–æ—Ä–æ–Ω–∏—Ç—å:
  - —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (`WAITING_SHOP_NAME` / `WAITING_PICKUP_ADDRESS` / `WAITING_PHONE`),
  - –≤–≤–µ–¥—ë–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.

5. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å –≤ —á–∞—Ç —Å —ç—Ç–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º:

```java
sendMessage(chatId, "üè™ *–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞* ...");
```

**–ò—Ç–æ–≥:**  
`startRegistration` —Å–≤—è–∑—ã–≤–∞–µ—Ç **–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π Telegram‚Äë–∞–ø–¥–µ–π—Ç** (`Update`) —Å:

- ID —á–∞—Ç–∞, –∫—É–¥–∞ –æ—Ç–≤–µ—á–∞—Ç—å (`chatId`),
- ID —é–∑–µ—Ä–∞ –≤ Telegram (`telegramId`),
- —Å–æ–∑–¥–∞–Ω–∏–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ `registrationDataMap`.

---

# 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤–æ –≤—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

–ú–µ—Ç–æ–¥:

```java
public boolean handleMessage(Update update) {
    Long telegramId = update.getMessage().getFrom().getId();
    Long chatId = update.getMessage().getChatId();
    String text = update.getMessage().getText();

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —é–∑–µ—Ä –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    ShopRegistrationData data = registrationDataMap.get(telegramId);
    if (data == null || data.getState() == RegistrationState.NONE) {
        return false; // –Æ–∑–µ—Ä –Ω–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    }

    log.debug("–û–±—Ä–∞–±–æ—Ç–∫–∞ —à–∞–≥–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: telegramId={}, state={}, text={}",
            telegramId, data.getState(), text);

    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
    switch (data.getState()) {
        case WAITING_SHOP_NAME:
            handleShopName(chatId, telegramId, text, data);
            break;
        case WAITING_PICKUP_ADDRESS:
            handlePickupAddress(chatId, telegramId, text, data);
            break;
        case WAITING_PHONE:
            // –û–∂–∏–¥–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç (–∫–Ω–æ–ø–∫—É), –∞ –Ω–µ —Ç–µ–∫—Å—Ç ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            sendMessage(chatId, "üëÜ –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É *\"–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞\"* –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞!");
            break;
        default:
            return false;
    }

    return true; // –°–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
}
```

–¢–µ–ø–µ—Ä—å —Ä–∞–∑–±–∏—Ä–∞–µ–º –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–µ –º–µ—Å—Ç–∞.

### –°–Ω–æ–≤–∞ `Update`, `getMessage()`, `getFrom()`, `getText()`

```java
Long telegramId = update.getMessage().getFrom().getId();
Long chatId = update.getMessage().getChatId();
String text = update.getMessage().getText();
```

- `update` ‚Äî –≤—Å—ë —Ç–æ—Ç –∂–µ –∫–æ–Ω–≤–µ—Ä—Ç –∏–∑ Telegram.
- `getMessage()` ‚Äî –¥–æ—Å—Ç–∞—ë–º –æ–±—ä–µ–∫—Ç `Message`.
  - –º—ã –∑–Ω–∞–µ–º (–∏–∑ `Bot`), —á—Ç–æ —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏** –≤ –∞–ø–¥–µ–π—Ç–µ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.
- `getFrom().getId()`:
  - `getFrom()` ‚Äî –∫—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ (Telegram‚Äë–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å).
  - `getId()` ‚Äî –µ–≥–æ Telegram‚ÄëID (—Ç–æ —Å–∞–º–æ–µ —á–∏—Å–ª–æ, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –º—ã –µ–≥–æ —Ö—Ä–∞–Ω–∏–º –≤ –ë–î).
- `getChatId()` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —á–∞—Ç–∞ (–∫—É–¥–∞ –Ω–∞–¥–æ –æ—Ç–≤–µ—á–∞—Ç—å).
- `getText()` ‚Äî —Å–∞–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–±—Ä–∞–ª —é–∑–µ—Ä.

–ê–Ω–∞–ª–æ–≥–∏—è:

- –∫–æ–Ω–≤–µ—Ä—Ç (`Update`) ‚Üí –ø–∏—Å—å–º–æ (`Message`) ‚Üí —Å–º–æ—Ç—Ä–∏:
  - –∫—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª (`from.id`),
  - –∫—É–¥–∞ –æ—Ç–≤–µ—á–∞—Ç—å (`chatId`),
  - —á—Ç–æ –Ω–∞–ø–∏—Å–∞–ª (`text`).

### –ü—Ä–æ–≤–µ—Ä–∫–∞, –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ª–∏ —Å–µ–π—á–∞—Å —é–∑–µ—Ä

```java
ShopRegistrationData data = registrationDataMap.get(telegramId);
if (data == null || data.getState() == RegistrationState.NONE) {
    return false; // –Æ–∑–µ—Ä –Ω–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
}
```

- –î–æ—Å—Ç–∞—ë–º –∏–∑ `registrationDataMap` –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ –∫–ª—é—á—É `telegramId`.
- –ï—Å–ª–∏:
  - `data == null` ‚Üí –º—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∏ –∑–∞–ø–∏—Å—å –¥–ª—è —ç—Ç–æ–≥–æ `telegramId`,
  - –∏–ª–∏ `state == NONE` ‚Üí —è–≤–Ω–æ –ø–æ–º–µ—Ç–∏–ª–∏, —á—Ç–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ—Ç ‚Äî
- —Ç–æ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç **–Ω–µ –∫ –Ω–∞—à–µ–º—É —Å—Ü–µ–Ω–∞—Ä–∏—é**.

–í–æ–∑–≤—Ä–∞—â–∞–µ–º `false`:

- —ç—Ç–∏–º –º—ã –≥–æ–≤–æ—Ä–∏–º `Bot`: "—è —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —Ç—Ä–æ–≥–∞—é, –ø—É—Å—Ç—å –¥—Ä—É–≥–∏–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã –ø–æ–ø—Ä–æ–±—É—é—Ç –µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å".

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```java
log.debug("–û–±—Ä–∞–±–æ—Ç–∫–∞ —à–∞–≥–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: telegramId={}, state={}, text={}",
        telegramId, data.getState(), text);
```

- –í –ª–æ–≥–µ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —É–≤–∏–¥–µ—Ç—å:

```text
–û–±—Ä–∞–±–æ—Ç–∫–∞ —à–∞–≥–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: telegramId=642867793, state=WAITING_SHOP_NAME, text=–¶–≤–µ—Ç—ã –Ω–∞ –õ–µ–Ω–∏–Ω–∞
```

–≠—Ç–æ —Å–∏–ª—å–Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç–ª–∞–≤–ª–∏–≤–∞—Ç—å, –Ω–∞ –∫–∞–∫–æ–º —à–∞–≥–µ —é–∑–µ—Ä –∑–∞–≤–∏—Å.

### `switch (data.getState())`

```java
switch (data.getState()) {
    case WAITING_SHOP_NAME:
        handleShopName(chatId, telegramId, text, data);
        break;
    case WAITING_PICKUP_ADDRESS:
        handlePickupAddress(chatId, telegramId, text, data);
        break;
    case WAITING_PHONE:
        // –û–∂–∏–¥–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç (–∫–Ω–æ–ø–∫—É), –∞ –Ω–µ —Ç–µ–∫—Å—Ç ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        sendMessage(chatId, "üëÜ –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É *\"–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞\"* –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞!");
        break;
    default:
        return false;
}
```

- `data.getState()` ‚Äî —ç—Ç–æ `RegistrationState` (enum):
  - `WAITING_SHOP_NAME`,
  - `WAITING_PICKUP_ADDRESS`,
  - `WAITING_PHONE`,
  - `NONE`.

`switch` ‚Äî —á–∏—Å—Ç–æ "–≤–µ—Ç–≤–ª–µ–Ω–∏–µ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—é":

- –ï—Å–ª–∏ –∂–¥—ë–º **–Ω–∞–∑–≤–∞–Ω–∏–µ**:
  - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å—ë –≤ `handleShopName(...)`.
- –ï—Å–ª–∏ –∂–¥—ë–º **–∞–¥—Ä–µ—Å**:
  - `handlePickupAddress(...)`.
- –ï—Å–ª–∏ –∂–¥—ë–º **—Ç–µ–ª–µ—Ñ–æ–Ω** (`WAITING_PHONE`):
  - –º—ã –ù–ï –¥–æ–ª–∂–Ω—ã –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ç–µ–∫—Å—Ç, –∞ –¥–æ–ª–∂–Ω—ã —Å–∫–∞–∑–∞—Ç—å —é–∑–µ—Ä—É:

```java
sendMessage(chatId, "üëÜ –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É *\"–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞\"* –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞!");
```

–¢–æ –µ—Å—Ç—å:

- –µ—Å–ª–∏ –æ–Ω –≤ —ç—Ç–æ—Ç –º–æ–º–µ–Ω—Ç –ø–æ—á–µ–º—É‚Äë—Ç–æ –ø–∏—à–µ—Ç —Ç–µ–∫—Å—Ç "–º–æ–π –Ω–æ–º–µ—Ä —Ç–∞–∫–æ–π‚Äë—Ç–æ",
- –º—ã –µ–≥–æ –≤–µ–∂–ª–∏–≤–æ —à–ª—ë–º –Ω–∞ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å **–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `Contact` –æ—Ç Telegram**, –∞ –Ω–µ –∫—Ä–∏–≤–æ–π —Ç–µ–∫—Å—Ç.

`default: return false;` ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –≤–Ω–µ–∑–∞–ø–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (—Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏).

### –í–æ–∑–≤—Ä–∞—â–∞–µ–º `true`

```java
return true; // –°–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ
```

- –ï—Å–ª–∏ –º—ã –¥–æ—à–ª–∏ —Å—é–¥–∞ ‚Äî –∑–Ω–∞—á–∏—Ç —ç—Ç–æ—Ç —Ö–µ–Ω–¥–ª–µ—Ä **–∑–∞–Ω–∏–º–∞–ª—Å—è** —ç—Ç–∏–º —Ç–µ–∫—Å—Ç–æ–º.
- `Bot` –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–µ –¥–∞—ë—Ç –¥—Ä—É–≥–∏–º —Ö–µ–Ω–¥–ª–µ—Ä–∞–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —ç—Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.


---

# 4. –®–∞–≥ 1 ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞

```java
private void handleShopName(Long chatId, Long telegramId, String text, ShopRegistrationData data) {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è: –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–º
    if (text.length() < 2) {
        sendMessage(chatId, "‚ùå –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ. –í–≤–µ–¥–∏ –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞:");
        return;
    }
    if (text.length() > 255) {
        sendMessage(chatId, "‚ùå –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ. –ú–∞–∫—Å–∏–º—É–º 255 —Å–∏–º–≤–æ–ª–æ–≤:");
        return;
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
    data.setShopName(text);
    data.setState(RegistrationState.WAITING_PICKUP_ADDRESS);

    sendMessage(chatId, "‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ: *" + text + "*\n\n" +
            "–®–∞–≥ 2 –∏–∑ 3\n" +
            "–í–≤–µ–¥–∏ *–∞–¥—Ä–µ—Å –∑–∞–±–æ—Ä–∞* –∑–∞–∫–∞–∑–æ–≤\n" +
            "(–æ—Ç–∫—É–¥–∞ –∫—É—Ä—å–µ—Ä –±—É–¥–µ—Ç –∑–∞–±–∏—Ä–∞—Ç—å —Ü–≤–µ—Ç—ã):");
}
```

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:

- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:
  - –¥–ª–∏–Ω–∞ ‚â• 2,
  - –¥–ª–∏–Ω–∞ ‚â§ 255 (–∫–∞–∫ –≤ –º–æ–¥–µ–ª–∏ `Shop`).
- –ï—Å–ª–∏ –≤—Å—ë –æ–∫:
  - –∫–ª–∞–¥—ë–º `shopName` –≤ `data`,
  - –º–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ `WAITING_PICKUP_ADDRESS`,
  - —à–ª—ë–º —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: "–®–∞–≥ 2: –≤–≤–µ–¥–∏ –∞–¥—Ä–µ—Å –∑–∞–±–æ—Ä–∞".

–ó–¥–µ—Å—å –º—ã –ø–æ–∫–∞ –ù–ò–ö–ê–ö –Ω–µ –ª–µ–∑–µ–º –≤ –ë–î ‚Äî –≤—Å—ë –∂–∏–≤—ë—Ç –≤ –ø–∞–º—è—Ç–∏ (`registrationDataMap`).

---

# 5. –®–∞–≥ 2 ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞–¥—Ä–µ—Å–∞ –∑–∞–±–æ—Ä–∞

```java
private void handlePickupAddress(Long chatId, Long telegramId, String text, ShopRegistrationData data) {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –∞–¥—Ä–µ—Å–∞
    if (text.length() < 5) {
        sendMessage(chatId, "‚ùå –ê–¥—Ä–µ—Å —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π. –í–≤–µ–¥–∏ –ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å:");
        return;
    }
    if (text.length() > 500) {
        sendMessage(chatId, "‚ùå –ê–¥—Ä–µ—Å —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π. –ú–∞–∫—Å–∏–º—É–º 500 —Å–∏–º–≤–æ–ª–æ–≤:");
        return;
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–¥—Ä–µ—Å –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
    data.setPickupAddress(text);
    data.setState(RegistrationState.WAITING_PHONE);

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º"
    sendMessageWithContactButton(chatId, "‚úÖ –ê–¥—Ä–µ—Å: *" + text + "*\n\n" +
            "–®–∞–≥ 3 –∏–∑ 3\n" +
            "–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ üëá");
}
```

–°–º—ã—Å–ª:

- –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É –∞–¥—Ä–µ—Å–∞: –Ω–µ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π/–¥–ª–∏–Ω–Ω—ã–π.
- –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–¥—Ä–µ—Å –≤ `data`.
- –°—Ç–∞–≤–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ `WAITING_PHONE`.
- –ò —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ **—Å Reply‚Äë–∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π**:
  - —Ç–∞–º –∫–Ω–æ–ø–∫–∞ `"üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞"` —Å `requestContact = true`.

`sendMessageWithContactButton`:

```java
KeyboardButton contactButton = new KeyboardButton("üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞");
contactButton.setRequestContact(true);  // –ú–∞–≥–∏—è! Telegram —Å–∞–º –ø–æ–ø—Ä–æ—Å–∏—Ç –Ω–æ–º–µ—Ä
```

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–º—ë—Ç —ç—Ç—É –∫–Ω–æ–ø–∫—É:

- Telegram —Å–∞–º —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ–±—ä–µ–∫—Ç `Contact` –≤–Ω—É—Ç—Ä–∏ `Message`,
- –≤ `Bot.onUpdateReceived` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `hasContact()`,
- –∏ —É–∂–µ —Ç–∞–º –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `shopRegistrationHandler.handleContact(update)`.

---

# 6. –®–∞–≥ 3 ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

```java
public boolean handleContact(Update update) {
    Long telegramId = update.getMessage().getFrom().getId();
    Long chatId = update.getMessage().getChatId();

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —é–∑–µ—Ä –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ —à–∞–≥–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
    ShopRegistrationData data = registrationDataMap.get(telegramId);
    if (data == null || data.getState() != RegistrationState.WAITING_PHONE) {
        return false; // –ö–æ–Ω—Ç–∞–∫—Ç –Ω–µ –æ–∂–∏–¥–∞–ª—Å—è
    }

    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
    Contact contact = update.getMessage().getContact();
    String phone = contact.getPhoneNumber();

    log.info("–ü–æ–ª—É—á–µ–Ω –∫–æ–Ω—Ç–∞–∫—Ç: telegramId={}, phone={}", telegramId, phone);

    data.setPhone(phone);

    // –°–æ–∑–¥–∞—ë–º –º–∞–≥–∞–∑–∏–Ω —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å
    try {
        Shop shop = shopService.createShopForUser(
                telegramId,
                data.getShopName(),
                data.getPickupAddress(),
                data.getPhone()
        );

        log.info("–ú–∞–≥–∞–∑–∏–Ω —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω: shopId={}, telegramId={}", shop.getId(), telegramId);

        // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        registrationDataMap.remove(telegramId);

        // –£–±–∏—Ä–∞–µ–º Reply-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ–∂–∏–¥–∞–Ω–∏–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
        sendMessageWithKeyboardRemove(chatId, "üéâ *–ú–∞–≥–∞–∑–∏–Ω —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!*\n\n" +
                "üìã *–î–∞–Ω–Ω—ã–µ:*\n" +
                "‚Ä¢ –ù–∞–∑–≤–∞–Ω–∏–µ: " + data.getShopName() + "\n" +
                "‚Ä¢ –ê–¥—Ä–µ—Å –∑–∞–±–æ—Ä–∞: " + data.getPickupAddress() + "\n" +
                "‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω: " + phone + "\n\n" +
                "‚è≥ *–û–∂–∏–¥–∞–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.*\n" +
                "–ü–æ—Å–ª–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ç—ã —Å–º–æ–∂–µ—à—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã!");

    } catch (Exception e) {
        log.error("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–∞: telegramId={}", telegramId, e);
        registrationDataMap.remove(telegramId);
        sendMessageWithKeyboardRemove(chatId, "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞: " + e.getMessage());
    }

    return true;
}
```

–û—á–µ–Ω—å –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç ‚Äî –∏–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è **`ShopService`** –∏ –∏–¥—ë—Ç —Ä–∞–±–æ—Ç–∞ —Å –ë–î.

–ü–æ—à–∞–≥–æ–≤–æ:

1. –î–æ—Å—Ç–∞—ë–º `telegramId` –∏ `chatId`.
2. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ—Ç —é–∑–µ—Ä —Ä–µ–∞–ª—å–Ω–æ –Ω–∞ —à–∞–≥–µ `WAITING_PHONE`:
   - –µ—Å–ª–∏ –Ω–µ—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º `false`, –∫–æ–Ω—Ç–∞–∫—Ç –Ω–µ –Ω–∞—à.
3. –ò–∑–≤–ª–µ–∫–∞–µ–º `Contact` –∏ `phoneNumber`.
4. –õ–æ–≥–∏—Ä—É–µ–º –Ω–æ–º–µ—Ä.
5. –ö–ª–∞–¥—ë–º `phone` –≤ `data`.
6. –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –º–∞–≥–∞–∑–∏–Ω:

```java
Shop shop = shopService.createShopForUser(
        telegramId,
        data.getShopName(),
        data.getPickupAddress(),
        data.getPhone()
);
```

–¢—É—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

- –ø–æ–∏—Å–∫ `User` –ø–æ `telegramId`,
- –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —É –Ω–µ–≥–æ –µ—â—ë –Ω–µ—Ç –º–∞–≥–∞–∑–∏–Ω–∞,
- —Å–æ–∑–¥–∞–Ω–∏–µ `Shop`,
- —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î.

7. –ï—Å–ª–∏ –≤—Å—ë –æ–∫:
   - –ø–∏—à–µ–º –ª–æ–≥,
   - —É–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `registrationDataMap`,
   - —É–±–∏—Ä–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É (`ReplyKeyboardRemove`),
   - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫—Ä–∞—Å–∏–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏—Ç–æ–≥–æ–º –∏ —Ñ—Ä–∞–∑–æ–π –ø—Ä–æ –æ–∂–∏–¥–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏.

8. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞:
   - –ª–æ–≥–∏—Ä—É–µ–º,
   - —á–∏—Å—Ç–∏–º `registrationDataMap`,
   - —à–ª—ë–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ.

---

# 7. –°—Ç–∞—Ä—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–∑ callback ("–ú–∞–≥–∞–∑–∏–Ω" –ø–æ—Å–ª–µ /start)

```java
public void startRegistrationFromCallback(Long telegramId, Long chatId) {
    log.info("–ù–∞—á–∞–ª–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞ (–∏–∑ callback): telegramId={}", telegramId);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —É–∂–µ –º–∞–≥–∞–∑–∏–Ω–∞ —É —ç—Ç–æ–≥–æ —é–∑–µ—Ä–∞
    if (shopService.findByUserTelegramId(telegramId).isPresent()) {
        sendMessage(chatId, "‚ùå –£ —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω!");
        return;
    }

    // –°–æ–∑–¥–∞—ë–º –¥–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ —Å—Ç–∞–≤–∏–º –ø–µ—Ä–≤—ã–π —à–∞–≥
    ShopRegistrationData data = new ShopRegistrationData();
    data.setState(RegistrationState.WAITING_SHOP_NAME);
    registrationDataMap.put(telegramId, data);

    sendMessage(chatId, "üè™ *–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞*\n\n" +
            "–®–∞–≥ 1 –∏–∑ 3\n" +
            "–í–≤–µ–¥–∏ *–Ω–∞–∑–≤–∞–Ω–∏–µ* —Ç–≤–æ–µ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞:");
}
```

–†–∞–∑–Ω–∏—Ü–∞ —Å `startRegistration(Update update)` —Ç–æ–ª—å–∫–æ –≤ —Ç–æ–º,
—á—Ç–æ —Å—é–¥–∞ —É–∂–µ –ø—Ä–∏–ª–µ—Ç–∞—é—Ç `telegramId` –∏ `chatId` –∏–∑ `CallbackQueryHandler`.

–≠—Ç–æ –∏–º–µ–Ω–Ω–æ —Å—Ü–µ–Ω–∞—Ä–∏–π:

- `/start` ‚Üí –∫–Ω–æ–ø–∫–∞ "–ú–∞–≥–∞–∑–∏–Ω" ‚Üí callback `"role_shop"` ‚Üí
  ‚Üí –≤ `CallbackQueryHandler` ‚Üí —Å—é–¥–∞.

---

# 8. –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã: –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è

## `sendMessageWithContactButton`

–°–æ–∑–¥–∞—ë—Ç Reply‚Äë–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–æ–π "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞":

```java
KeyboardButton contactButton = new KeyboardButton("üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞");
contactButton.setRequestContact(true);
```

Telegram —Å–∞–º –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –Ω–æ–º–µ—Ä–∞ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `Contact`.

## `sendMessageWithKeyboardRemove`

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ **—É–±–∏—Ä–∞–µ—Ç** –∫–∞—Å—Ç–æ–º–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É:

```java
message.setReplyMarkup(new ReplyKeyboardRemove(true));
```

–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º" —Ç–æ—Ä—á–∞–ª–∞ –≤–µ—á–Ω–æ.

## `sendMessage`

–ü—Ä–æ—Å—Ç–æ —à–ª—ë—Ç —Ç–µ–∫—Å—Ç —Å Markdown‚Äë—Ä–∞–∑–º–µ—Ç–∫–æ–π.

## `sendMessageWithCreateOrderButton`

–®–ª—ë—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å inline‚Äë–∫–Ω–æ–ø–∫–æ–π `"üì¶ –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑"`:

- `InlineKeyboardButton` —Å `callbackData = "create_order"`,
- —ç—Ç–æ–π –∫–Ω–æ–ø–∫–æ–π –ø–æ—Ç–æ–º –ø–æ–ª—å–∑—É–µ—Ç—Å—è `CallbackQueryHandler`.

---

## –ò—Ç–æ–≥–æ–≤–∞—è –∫–∞—Ä—Ç–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –º–∞–≥–∞–∑–∏–Ω–∞

```text
1) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–º—ë—Ç:
   - /register_shop
   –∏–ª–∏
   - /start ‚Üí –∫–Ω–æ–ø–∫–∞ "–ú–∞–≥–∞–∑–∏–Ω"

2) Bot:
   ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç ShopRegistrationHandler.startRegistration(...) / startRegistrationFromCallback(...)
   ‚Üí —Å–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ registrationDataMap[telegramId]
   ‚Üí —Å–ø—Ä–∞—à–∏–≤–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ (–®–∞–≥ 1)

3) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —à–ª—ë—Ç —Ç–µ–∫—Å—Ç —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º
   ‚Üí handleMessage(...)
      state = WAITING_SHOP_NAME
      ‚Üí handleShopName(...)
      ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ–º name, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ WAITING_PICKUP_ADDRESS
      ‚Üí —Å–ø—Ä–∞—à–∏–≤–∞–µ–º –∞–¥—Ä–µ—Å (–®–∞–≥ 2)

4) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —à–ª—ë—Ç —Ç–µ–∫—Å—Ç —Å –∞–¥—Ä–µ—Å–æ–º
   ‚Üí handleMessage(...)
      state = WAITING_PICKUP_ADDRESS
      ‚Üí handlePickupAddress(...)
      ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∞–¥—Ä–µ—Å, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ WAITING_PHONE
      ‚Üí —à–ª—ë–º –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º"

5) –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–º—ë—Ç –∫–Ω–æ–ø–∫—É "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞"
   ‚Üí Bot.onUpdateReceived –≤–∏–¥–∏—Ç contact
   ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç handleContact(...)
      - –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ state = WAITING_PHONE
      - —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω –≤ data
      - –≤—ã–∑—ã–≤–∞–µ–º ShopService.createShopForUser(...)
      - —É–¥–∞–ª—è–µ–º –∑–∞–ø–∏—Å—å –∏–∑ registrationDataMap
      - —à–ª—ë–º —Å–æ–æ–±—â–µ–Ω–∏–µ "–º–∞–≥–∞–∑–∏–Ω –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –∂–¥—ë—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–∏"

6) –î–∞–ª–µ–µ:
   - –∞–¥–º–∏–Ω/–∫–æ–º–∞–Ω–¥–∞ /r –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –º–∞–≥–∞–∑–∏–Ω
   - –º–µ–Ω—é –º–∞–≥–∞–∑–∏–Ω–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.
```

---

## –ß—Ç–æ –¥–∞–ª—å—à–µ —Ä–∞–∑–±–∏—Ä–∞—Ç—å

–ü–æ –ª–∏–Ω–∏–∏ –º–∞–≥–∞–∑–∏–Ω–æ–≤ —Ç—ã —É–∂–µ –ø–æ–Ω–∏–º–∞–µ—à—å:

- `Shop` (–º–æ–¥–µ–ª—å),
- `ShopRepository`,
- `ShopService`,
- `ShopRegistrationHandler`.

–°–ª–µ–¥—É—é—â–∏–µ –ª–æ–≥–∏—á–Ω—ã–µ –∫–∞–Ω–¥–∏–¥–∞—Ç—ã –¥–ª—è —Ä–∞–∑–±–æ—Ä–æ–≤:

- `StartCommandHandler` ‚Äî –∫–∞–∫ –±–æ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `/start`, —Å–æ–∑–¥–∞—ë—Ç `User` –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä —Ä–æ–ª–∏.
- `CallbackQueryHandler` ‚Äî –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–æ–∫ "–ú–∞–≥–∞–∑–∏–Ω"/"–ö—É—Ä—å–µ—Ä", "–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑" –∏ —Ç.–¥.
- `Bot.java` ‚Äî –≥–ª–∞–≤–Ω—ã–π –≤—Ö–æ–¥, –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è `Update` –ø–æ —Ö–µ–Ω–¥–ª–µ—Ä–∞–º.

–ú–æ–∂–µ–º –ø–æ–π—Ç–∏:

- –ª–∏–±–æ –¥–∞–ª—å—à–µ –ø–æ **–æ–±—â–µ–º—É —Ñ–ª–æ—É –±–æ—Ç–∞** (`StartCommandHandler`, `CallbackQueryHandler`, `Bot`),
- –ª–∏–±–æ –Ω–∞—á–∞—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—É—é –ª–∏–Ω–∏—é –¥–ª—è **–∫—É—Ä—å–µ—Ä–∞** (`Courier`, `CourierService`, `CourierRegistrationHandler` –∏ —Ç.–¥.).

